---
import Layout from '../layouts/Layout.astro';
import feedbackRaw from '../../teaching/feedback.md?raw';

const base = import.meta.env.BASE_URL;
const withBase = (path: string) => `${base}${path.replace(/^\//, '')}`;

const glance = [
	{ emoji: 'üêç', value: '15+', label: 'Courses taught' },
	{ emoji: 'üë©‚Äçüéì', value: '150+', label: 'Students per semester' },
	{ emoji: 'üéì', value: 'Grad + UG', label: 'Both levels' },
	{ emoji: 'üíª', value: 'Python', label: 'Most-taught language' },
	{ emoji: 'ü§ñ', value: 'AI & UX', label: 'Core focus areas' },
	{ emoji: '‚≠ê', value: 'Award', label: 'Service recognition' },
];

const graduate = [
	{
		code: 'BITM 522',
		title: 'Managing Information Technology',
		icon: 'fa-server',
		description: 'Strategic management of IT resources, digital transformation, enterprise systems, and aligning technology with business objectives.'
	},
	{
		code: 'INF 501',
		title: 'Case Studies in Digital Citizenship',
		icon: 'fa-users',
		description: 'Examining real-world cases of digital ethics, online civic engagement, media literacy, and responsible technology use in society.'
	},
	{
		code: 'BITM 534',
		title: 'Field Study in IS and Business Analytics',
		icon: 'fa-chart-line',
		description: 'Applied research practicum partnering with organizations to solve real business problems using data analytics and IS methods.'
	},
	{
		code: 'INFO 646',
		title: 'Digital Product Design (Advanced UX)',
		icon: 'fa-pen-ruler',
		description: 'End-to-end product design process ‚Äî from user research and wireframing through high-fidelity prototyping and usability testing.'
	},
	{
		code: 'INFO 642',
		title: 'Content Strategy',
		icon: 'fa-file-alt',
		description: 'Planning, creating, and governing digital content across channels ‚Äî information architecture, editorial workflows, and content audits.'
	},
];

const undergraduate = [
	{
		code: 'BITM 330',
		title: 'Improving Business Performance with IT',
		icon: 'fa-briefcase',
		description: 'How organizations leverage information technology to drive efficiency, innovation, and competitive advantage. 150+ students per section.'
	},
	{
		code: 'ISBA 434',
		title: 'Business Analytics Practicum',
		icon: 'fa-database',
		description: 'Hands-on analytics projects using real data ‚Äî SQL, Python, dashboards, and communicating insights to stakeholders.'
	},
	{
		code: 'INF 108',
		title: 'Intro to Python',
		icon: 'fa-code',
		description: 'Foundational Python programming: variables, control flow, functions, data structures, and introductory data analysis.'
	},
	{
		code: 'INF 308',
		title: 'Advanced Python',
		icon: 'fa-terminal',
		description: 'Object-oriented programming, APIs, web scraping, data pipelines, and building real-world applications with Python.'
	},
	{
		code: 'INF 496',
		title: 'UX in E-Commerce',
		icon: 'fa-shopping-cart',
		description: 'User experience principles applied to online retail ‚Äî conversion optimization, A/B testing, checkout flows, and persuasive design.'
	},
	{
		code: 'INF 200',
		title: 'Research Methods for Information Studies',
		icon: 'fa-flask',
		description: 'Quantitative and qualitative research design, surveys, experiments, data collection, and statistical analysis fundamentals.'
	},
	{
		code: 'INF 401',
		title: 'Case Studies in Digital Citizenship',
		icon: 'fa-globe',
		description: 'Exploring digital rights, misinformation, online safety, and ethical technology use through real-world case analysis.'
	},
];

const graduateGalleryImages = [
	'https://res.cloudinary.com/dkndq6lyz/image/upload/v1770858141/APaQ0SSruQHJAILq9qeOP90kUJaP0Iwyl7CHw-3mk3Ep-QqcH3znXVIMOa2zQp6bfFEwXyEloojOg7oStbWM49UQ_y7JurVMipY37o0uW_YMWuY63njomkFWXaGgVPmJ77BG69R0zmOFgKB7aXUoho1QK6ffPdtMwwDwZenfsFWwGMLDABm7yoizL5wr2KqtOvdX6SUnLoBS0-37kjlKj8_UsGK4Qd7ss3cfqKNNJaM_w1280_evph4h.jpg',
	'https://res.cloudinary.com/dkndq6lyz/image/upload/v1771138715/me-teaching2_yt11a0.jpg',
	'https://res.cloudinary.com/dkndq6lyz/image/upload/v1771138717/me-teaching3_sspjrv.jpg',
	'https://res.cloudinary.com/dkndq6lyz/image/upload/v1771138719/me-teaching5_mj5t9u.webp',
	'https://res.cloudinary.com/dkndq6lyz/image/upload/v1771138722/me-teaching8_plhrqy.jpg',
	'https://res.cloudinary.com/dkndq6lyz/image/upload/v1771138723/me-teaching9_z4v7la.jpg',
	'https://res.cloudinary.com/dkndq6lyz/image/upload/v1771138721/me-teaching7_lixiz2.jpg',
];

const undergraduateGalleryImages = [
	'https://res.cloudinary.com/dkndq6lyz/image/upload/v1771138715/me-teaching_f63xsl.jpg',
	'https://res.cloudinary.com/dkndq6lyz/image/upload/v1771138715/me-teaching2_yt11a0.jpg',
	'https://res.cloudinary.com/dkndq6lyz/image/upload/v1771138720/me-teaching6_p4f8g7.jpg',
	'https://res.cloudinary.com/dkndq6lyz/image/upload/v1771138722/me-teaching8_plhrqy.jpg',
	'https://res.cloudinary.com/dkndq6lyz/image/upload/v1771138724/me-teaching10_bhiacw.jpg',
	'https://res.cloudinary.com/dkndq6lyz/image/upload/v1771138723/me-teaching9_z4v7la.jpg',
	'https://res.cloudinary.com/dkndq6lyz/image/upload/v1771138726/me-teaching12_bmaugv.jpg',
	'https://res.cloudinary.com/dkndq6lyz/image/upload/v1771138725/me-teaching11_bmostq.jpg',
	'https://res.cloudinary.com/dkndq6lyz/image/upload/v1771138729/me-teaching14_ywtjk7.jpg',
	'https://res.cloudinary.com/dkndq6lyz/image/upload/v1771138728/me-teaching13_fbtkf3.jpg',
];

const feedbackEntries = feedbackRaw
	.split(/\r?\n\s*---+\s*\r?\n/g)
	.map((block) => block.trim())
	.filter(Boolean)
	.map((block) => {
		const normalizedBlock = block.replace(/\*\*/g, '').trim();
		const courseMatch = normalizedBlock.match(/(?:-|‚Äì|\.)?\s*([A-Za-z]{3,5}\s*\d{3})\s*$/i);
		const course = (courseMatch?.[1] ?? '')
			.replace(/\s+/g, ' ')
			.trim()
			.toUpperCase();

		const quoteMatch = normalizedBlock.match(/"([\s\S]*?)"/);
		let quote = quoteMatch?.[1] ?? normalizedBlock;

		if (!quoteMatch && courseMatch) {
			quote = quote.replace(/(?:-|‚Äì|\.)?\s*[A-Za-z]{3,5}\s*\d{3}\s*$/i, '');
		}

		quote = quote.replace(/\s+/g, ' ').trim();

		return { quote, course };
	})
	.filter((entry) => entry.quote.length > 0);
---

<Layout
	title="Teaching"
	description="Courses on HCI, UX research, responsible AI, and information engagement."
>
	<div class="teaching-hero">
		<div id="particles-header"></div>
		<div class="hero-inner">
			<h1>Teaching</h1>
			<p class="hero-subtitle"><i class="fas fa-bolt"></i> At a Glance</p>
			<ul class="glance-strip">
				{glance.map((item) => (
					<li>
						<span class="glance-emoji">{item.emoji}</span>
						<span class="glance-value">{item.value}</span>
						<span class="glance-label">{item.label}</span>
					</li>
				))}
			</ul>
		</div>
	</div>

	<script is:inline src={`${import.meta.env.BASE_URL}js/particles.js`}></script>
	<script is:inline>
		document.addEventListener('DOMContentLoaded', function() {
			if (typeof particlesJS !== 'undefined') {
				particlesJS('particles-header', {
					particles: {
						number: { value: 60, density: { enable: true, value_area: 800 } },
						color: { value: '#ffffff' },
						shape: { type: 'circle' },
						opacity: { value: 0.5, random: true },
						size: { value: 3, random: true },
						line_linked: { enable: true, distance: 150, color: '#ffffff', opacity: 0.3, width: 1 },
						move: { enable: true, speed: 1, direction: 'none', random: true, straight: false, out_mode: 'out' }
					},
					interactivity: {
						detect_on: 'canvas',
						events: { onhover: { enable: true, mode: 'grab' }, onclick: { enable: true, mode: 'push' }, resize: true },
						modes: { grab: { distance: 140, line_linked: { opacity: 1 } }, push: { particles_nb: 4 } }
					},
					retina_detect: true
				});
			}
		});
	</script>

	<section class="course-section">
		<div class="teaching-gallery" aria-label="Graduate teaching image gallery">
			<div id="graduate-gallery-particles" class="gallery-particles" aria-hidden="true"></div>
			<img id="graduate-gallery-image" src={graduateGalleryImages[0]} alt="Graduate teaching moments" loading="lazy" class="gallery-image visible" />
			<script id="graduate-gallery-data" type="application/json" set:html={JSON.stringify(graduateGalleryImages)}></script>
		</div>
		<h2 class="section-title"><i class="fas fa-user-graduate"></i> Graduate</h2>
		<div class="courses">
			{graduate.map((c) => (
				<details class="course">
					<summary>
						<div>
							<h3><i class={`fas ${c.icon}`}></i> {c.code} ‚Äî {c.title}</h3>
						</div>
						<span class="chevron" aria-hidden="true"></span>
					</summary>
					<div class="content">
						<p>{c.description}</p>
					</div>
				</details>
			))}
		</div>
	</section>

	<section class="course-section">
		<div class="teaching-gallery" aria-label="Undergraduate teaching image gallery">
			<div id="undergraduate-gallery-particles" class="gallery-particles" aria-hidden="true"></div>
			<img id="undergraduate-gallery-image" src={undergraduateGalleryImages[0]} alt="Undergraduate teaching moments" loading="lazy" class="gallery-image visible" />
			<script id="undergraduate-gallery-data" type="application/json" set:html={JSON.stringify(undergraduateGalleryImages)}></script>
		</div>
		<h2 class="section-title"><i class="fas fa-book-open"></i> Undergraduate</h2>
		<div class="courses">
			{undergraduate.map((c) => (
				<details class="course">
					<summary>
						<div>
							<h3><i class={`fas ${c.icon}`}></i> {c.code} ‚Äî {c.title}</h3>
						</div>
						<span class="chevron" aria-hidden="true"></span>
					</summary>
					<div class="content">
						<p>{c.description}</p>
					</div>
				</details>
			))}
		</div>
	</section>

	<section class="course-section feedback-section">
		<h2 class="section-title"><i class="fas fa-comments"></i> Student Feedback</h2>
		<div class="feedback-grid">
			<div class="feedback-images">
				<img src={withBase('/images/teaching/appriciation-letters.jpg')} alt="Student thank-you notes" loading="lazy" />
				<img src={withBase('/images/teaching/me-class.gif')} alt="In-class student interaction" loading="lazy" />
			</div>

			<div class="feedback-carousel" aria-live="polite">
				<p class="feedback-label">What students are saying</p>
				<blockquote id="feedback-quote"></blockquote>
				<p id="feedback-course"></p>
				<script id="feedback-data" type="application/json" set:html={JSON.stringify(feedbackEntries)}></script>
			</div>
		</div>
	</section>

	<script is:inline>
		document.addEventListener('DOMContentLoaded', function() {
			if (typeof particlesJS !== 'undefined') {
				const galleryParticlesConfig = {
					particles: {
						number: { value: 92, density: { enable: true, value_area: 700 } },
						color: { value: '#f8fafc' },
						shape: { type: 'circle' },
						opacity: { value: 0.62, random: true },
						size: { value: 3.1, random: true },
						line_linked: { enable: true, distance: 130, color: '#ffffff', opacity: 0.42, width: 1.2 },
						move: { enable: true, speed: 0.65, direction: 'none', random: true, straight: false, out_mode: 'out' }
					},
					interactivity: {
						detect_on: 'canvas',
						events: { onhover: { enable: false }, onclick: { enable: false }, resize: true }
					},
					retina_detect: true
				};

				particlesJS('graduate-gallery-particles', galleryParticlesConfig);
				particlesJS('undergraduate-gallery-particles', galleryParticlesConfig);
			}

			const initializeGallery = (dataId, imageId, intervalMs) => {
				const dataNode = document.getElementById(dataId);
				const imageNode = document.getElementById(imageId);
				if (!dataNode || !imageNode) return;

				const images = JSON.parse(dataNode.textContent || '[]');
				if (!Array.isArray(images) || images.length === 0) return;

				let currentIndex = 0;
				const rotateImage = () => {
					let nextIndex = Math.floor(Math.random() * images.length);
					if (images.length > 1) {
						while (nextIndex === currentIndex) {
							nextIndex = Math.floor(Math.random() * images.length);
						}
					}

					imageNode.classList.remove('visible');
					setTimeout(() => {
						imageNode.src = images[nextIndex];
						imageNode.classList.add('visible');
					}, 180);
					currentIndex = nextIndex;
				};

				if (images.length > 1) {
					setInterval(rotateImage, intervalMs);
				}
			};

			initializeGallery('graduate-gallery-data', 'graduate-gallery-image', 3800);
			initializeGallery('undergraduate-gallery-data', 'undergraduate-gallery-image', 4200);

			const dataNode = document.getElementById('feedback-data');
			const quoteElement = document.getElementById('feedback-quote');
			const courseElement = document.getElementById('feedback-course');

			if (!dataNode || !quoteElement || !courseElement) return;

			const feedback = JSON.parse(dataNode.textContent || '[]');
			if (!Array.isArray(feedback) || feedback.length === 0) return;

			let currentIndex = -1;
			const rotateFeedback = () => {
				let nextIndex = Math.floor(Math.random() * feedback.length);
				if (feedback.length > 1) {
					while (nextIndex === currentIndex) {
						nextIndex = Math.floor(Math.random() * feedback.length);
					}
				}

				const next = feedback[nextIndex];
				quoteElement.classList.remove('visible');
				courseElement.classList.remove('visible');

				setTimeout(() => {
					quoteElement.textContent = `‚Äú${next.quote}‚Äù`;
					courseElement.textContent = next.course ? `‚Äî ${next.course}` : '';
					quoteElement.classList.add('visible');
					courseElement.classList.add('visible');
				}, 120);

				currentIndex = nextIndex;
			};

			rotateFeedback();
			setInterval(rotateFeedback, 5500);
		});
	</script>
</Layout>

<style>
	/* ===== HERO ===== */
	.teaching-hero {
		position: relative;
		width: 100vw;
		margin-left: calc(-50vw + 50%);
		margin-top: -24px;
		background: linear-gradient(135deg, #1e3a5f 0%, #0f172a 100%);
		padding: 60px 24px 72px;
		margin-bottom: 48px;
		color: #fff;
		overflow: hidden;
	}

	#particles-header {
		position: absolute;
		top: 0; left: 0;
		width: 100%; height: 100%;
		z-index: 1;
	}

	.hero-inner {
		position: relative;
		z-index: 2;
		max-width: 1100px;
		margin: 0 auto;
		text-align: center;
	}

	.hero-inner h1 {
		font-size: 56px;
		font-weight: 800;
		margin: 0 0 12px;
		line-height: 1.05;
		letter-spacing: -0.03em;
		color: #fff;
	}

	.hero-subtitle {
		font-size: 16px;
		font-weight: 600;
		margin: 0 0 28px;
		color: rgba(255,255,255,0.7);
		display: flex;
		align-items: center;
		justify-content: center;
		gap: 8px;
	}
	.hero-subtitle i { color: #fbbf24; }

	.glance-strip {
		list-style: none;
		margin: 0 auto;
		padding: 0;
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
		gap: 12px;
		max-width: 960px;
	}

	.glance-strip li {
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 4px;
		padding: 16px 10px;
		border-radius: 14px;
		background: rgba(0,0,0,0.22);
		border: 1px solid rgba(255,255,255,0.08);
	}

	.glance-emoji { font-size: 24px; }
	.glance-value { font-weight: 700; font-size: 18px; color: #fff; }
	.glance-label { font-size: 12px; color: rgba(255,255,255,0.6); line-height: 1.3; text-align: center; }

	/* ===== COURSE SECTIONS ===== */
	.course-section {
		max-width: 1000px;
		margin: 0 auto 40px;
		padding: 0 24px;
	}

	.feedback-section {
		margin-bottom: 56px;
	}

	.section-title {
		font-size: 24px;
		margin: 0 0 16px;
		color: #0f172a;
		display: flex;
		align-items: center;
		gap: 10px;
	}
	.section-title i { color: #1e3a5f; }

	.courses {
		display: grid;
		gap: 12px;
	}

	.course {
		background: #ffffff;
		border: 1px solid #e5e7eb;
		border-radius: 14px;
		padding: 0;
		box-shadow: 0 4px 14px rgba(0, 0, 0, 0.04);
	}

	summary {
		list-style: none;
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 16px;
		padding: 16px 20px;
		cursor: pointer;
	}

	summary::-webkit-details-marker {
		display: none;
	}

	summary h3 {
		margin: 0;
		font-size: 16px;
		font-weight: 600;
		color: #0f172a;
		display: flex;
		align-items: center;
		gap: 10px;
	}
	summary h3 i { color: #1e3a5f; font-size: 15px; }

	.chevron {
		width: 10px;
		height: 10px;
		border-right: 2px solid #94a3b8;
		border-bottom: 2px solid #94a3b8;
		transform: rotate(45deg);
		transition: transform 0.2s ease;
		flex-shrink: 0;
	}

	details[open] .chevron {
		transform: rotate(-135deg);
	}

	.content {
		border-top: 1px solid #e5e7eb;
		padding: 14px 20px 18px;
	}

	.content p {
		margin: 0;
		color: #475569;
		line-height: 1.7;
		font-size: 15px;
	}

	.teaching-gallery {
		position: relative;
		display: flex;
		align-items: center;
		justify-content: center;
		margin-bottom: 14px;
		padding: 16px;
		height: 420px;
		border: 1px solid #e5e7eb;
		border-radius: 14px;
		overflow: hidden;
		box-shadow: 0 4px 14px rgba(0, 0, 0, 0.04);
		background: linear-gradient(135deg, #1e3a5f 0%, #0f172a 100%);
	}

	.gallery-particles {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		z-index: 1;
		pointer-events: none;
	}

	.gallery-image {
		position: relative;
		z-index: 2;
		display: block;
		width: 100%;
		height: 100%;
		object-fit: contain;
		object-position: center center;
		opacity: 0;
		transition: opacity 220ms ease;
	}

	.gallery-image.visible {
		opacity: 1;
	}

	.feedback-grid {
		display: grid;
		grid-template-columns: 1.1fr 1fr;
		gap: 20px;
		align-items: stretch;
	}

	.feedback-images {
		display: grid;
		grid-template-columns: 1fr;
		gap: 14px;
	}

	.feedback-images img {
		width: 100%;
		height: 220px;
		object-fit: cover;
		border-radius: 14px;
		border: 1px solid #e5e7eb;
		box-shadow: 0 4px 14px rgba(0, 0, 0, 0.04);
	}

	.feedback-carousel {
		background: #ffffff;
		border: 1px solid #e5e7eb;
		border-radius: 14px;
		padding: 20px;
		box-shadow: 0 4px 14px rgba(0, 0, 0, 0.04);
		display: flex;
		flex-direction: column;
		justify-content: center;
	}

	.feedback-label {
		margin: 0 0 10px;
		font-size: 12px;
		font-weight: 700;
		color: #1e3a5f;
		letter-spacing: 0.06em;
		text-transform: uppercase;
	}

	#feedback-quote {
		margin: 0;
		font-size: 20px;
		line-height: 1.55;
		color: #0f172a;
		font-weight: 600;
		opacity: 0;
		transition: opacity 200ms ease;
	}

	#feedback-course {
		margin: 14px 0 0;
		font-size: 14px;
		font-weight: 700;
		color: #475569;
		opacity: 0;
		transition: opacity 200ms ease;
	}

	#feedback-quote.visible,
	#feedback-course.visible {
		opacity: 1;
	}

	@media (max-width: 640px) {
		summary {
			padding: 14px 16px;
		}
		summary h3 { font-size: 14px; }

		.gallery-image {
			height: 100%;
		}

		.teaching-gallery {
			height: 300px;
			padding: 10px;
		}

		.feedback-grid {
			grid-template-columns: 1fr;
		}

		.feedback-images img {
			height: 180px;
		}

		#feedback-quote {
			font-size: 18px;
		}
	}

	@media (max-width: 600px) {
		.teaching-hero { padding: 40px 16px 48px; }
		.hero-inner h1 { font-size: 40px; }
		.glance-strip { grid-template-columns: repeat(2, 1fr); }
	}
</style>
